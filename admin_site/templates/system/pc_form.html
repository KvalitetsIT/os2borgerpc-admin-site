{% extends "site_with_navigation.html" %}

{% block specific_title %}
Computere
{% endblock %}

{% block specific_documentation_links %}
  <li><a href="{% url 'doc' 'computers' %}"><i class="icon-question-sign icon-white"></i> Administration af computere</a></li>
{% endblock %}

{% block javascripts %}
<script type="text/javascript" src="/static/js/pcgrouplist.js"></script>
<script type="text/javascript" src="/static/js/configlist.js"></script>
{% endblock %}


{% block computers_active %}
class="active"
{% endblock %}

{% block specific_content %}

  <script type="text/javascript">
    $(document).ready( function() {
      var el = document.getElementById("{{ selected_pc.uid }}");
      el.scrollIntoView(true);
    });

    $(function(){
      var hash = window.location.hash;
      if (hash) {
        $('ul.nav a[href="' + hash + '"]').tab('show');
        console.log($('#computer_jobs_table').scrollTop());
      };
      $('.nav-tabs a').on("click", function (e) {
        $(this).tab('show');
        var scrollmem = $('.main').scrollTop();
        window.location.hash = this.hash;
        $('.main').scrollTop(scrollmem);
      });
    });
  </script>

  <ul class="sublevelnav">
    {% if not pc_list.all%}
      <li>Der er ingen computere</li>
    {% endif %}
    {% for pc in pc_list %}
    <li {% ifequal pc selected_pc %}class="active" %}{% endifequal %}>
        {% ifequal pc selected_pc %}
          <a class="remove float-end" href="/site/{{ site.url }}/computers/{{ selected_pc.uid }}/delete/" title="Slet computer"><i class="icon-remove icon-white"></i></a>
        {% endifequal %}
        <div id="{{pc.uid}}"> <a class="list-item" href="/site/{{ site.url }}/computers/{{ pc.uid }}" onclick="spin();"><i class="icon-hdd"></i> {{ pc.name }}</a>
        </div>
      </li>
    {% endfor %}
  </ul>

  <div class="container-fluid main sublevelmain">

    <h2 class="divideheader">Detaljer om <em>{{ selected_pc.name }}</em>
      {% if selected_pc.securityevent_set.count > 0 %}
      <a href="/site/{{ site.url }}/security/pc/{{ pc.uid }}" title=" Se advarsler for denne PC"><span class="badge badge-important">
              <icon
                                                                                                                          class="{% if has_security_warnings %}icon-fire{% else %}icon-ok{% endif %} icon-white">
              </icon></span></a>
{% endif %}
    </h2>
    {% include 'notification.html' %}

    {% if selected_pc.last_seen %}
      <p class="" style="float:right;"><span class="muted"> &nbsp;Senest
          set:</span> <strong>{{ selected_pc.last_seen|date:'Y-m-d H:i:s' }} </strong></p>
    {% endif %}
    {% if security_event != "Ingen advarsler"%}
      <p style="float:right; clear:right;"><span class="muted"> &nbsp;Seneste advarsel set:</span> <strong>{{ security_event.reported_time|date }} </strong> {{ security_event.reported_time|time }}</p>
    {% endif %}

    <form name="pc_update_form" id="pc_update_form" action="{% url 'computer' site.uid selected_pc.uid %}" method="post">
      {% csrf_token %}

      <button class="btn btn-primary">Gem Ã¦ndringer</button>
      <button class="btn" onclick="return ((location.href = '{% url 'computer' site.uid selected_pc.uid %}') && false)">Annuller</button>

      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="active nav-link" href="#pc-details" data-toggle="tab">Detaljer</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#pc-configs" data-toggle="tab">Konfigurationer</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#pc-jobs" data-toggle="tab">Jobhistorik</a>
        </li>
      </ul>

      <div id="pc-details" class="tabcontent active">
        <div class="row-fluid">
          <fieldset class="span6">
            <label for="id_name">Navn:</label>
            {{ form.name.errors }}
            {{ form.name }}

            <label for="id_description">Beskrivelse:</label>
            {{ form.description.errors }}
            {{ form.description }}

            <label for="id_location">Lokation:</label>
            {{ form.location.errors }}
            {{ form.location }}

            <label class="checkbox" for="id_is_active">
              {{ form.is_active.errors }}
              {{ form.is_active }} Aktiv
            </label>

          </fieldset>
          <fieldset class="span6">
            {{ form.pc_groups.errors }}
            <label>Grupper:</label>
            {% include 'system/pcgrouplist/list.html' with submit_name='pc_groups' %}
          </fieldset>
        </div>
      </div>

      <div id="pc-configs" class="tabcontent">
        <fieldset>
          {% include 'system/configlist/list.html' with entries=selected_pc.configuration.entries.all  cnf_id='pc_config' %}
        </fieldset>
      </div>

      <div id="pc-jobs" class="tabcontent">
        <table id="computer_jobs_table" class="table jobtable">
          <tr>
            {% include 'widgets/orderby_th.html' with key='batch__script__name' label='Script' anchor='#pc-jobs' %}
            {% include 'widgets/orderby_th.html' with key='started' label='Startet' anchor='#pc-jobs' %}
            {% include 'widgets/orderby_th.html' with key='finished' label='Sluttet' anchor='#pc-jobs' %}
            {% include 'widgets/orderby_th.html' with key='status' label='Status' anchor='#pc-jobs' %}
            {% include 'widgets/orderby_th.html' with key='batch__name' label='Batch' anchor='#pc-jobs' %}
            <th></th>
          </tr>
          {% for job in joblist %}
          <tr class="muted">
            <td class="{% ifequal orderby_key 'batch__script__name' %}orderby-highligt{% endifequal %}">{{job.batch.script.name}}</td>
            <td class="{% ifequal orderby_key 'started' %}orderby-highligt{% endifequal %}">{{job.started|default:'&nbsp'}}</td>
            <td class="{% ifequal orderby_key 'finished' %}orderby-highligt{% endifequal %}">{{job.finished|default:'&nbsp'}}</td>
            <td class="{% ifequal orderby_key 'status' %}orderby-highligt{% endifequal %}"><span class="label {{job.status_label}}">{{job.status_translated}}</span></td>
            <td class="{% ifequal orderby_key 'batch__name' %}orderby-highligt{% endifequal %}">{{job.batch.name}}</td>
            <td>
              {% if job.has_info %}
              <button class="btn jobinfobutton" data-pk="{{ job.pk }}"><i class="icon-info-sign"></i></button>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </table>

        <script type="text/javascript"><!--
          $(function() {
            BibOS.setupJobInfoButtons($('#computer_jobs_table'));
          });
        //--></script>

      </div>

    </form>

    {% include 'system/configlist/templates.html' %}
  </p>
{% endblock %}
